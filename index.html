<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Advanced Dark Video Call UI</title>
<style>
  body {
    margin: 0;
    background-color: #0d0d0d;
    font-family: 'Segoe UI', sans-serif;
    overflow: hidden;
    color: #fff;
  }

  /* CONTROLS */
  #controls {
    position: fixed;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    gap: 15px;
    background: rgba(30,30,30,0.8);
    padding: 12px 25px;
    border-radius: 30px;
    backdrop-filter: blur(8px);
    box-shadow: 0 0 15px rgba(0,0,0,0.5);
    z-index: 1000;
    transition: transform 0.2s;
  }

  #controls:hover {
    transform: translateX(-50%) scale(1.05);
  }

  button, select {
    background: #222;
    color: #fff;
    border: none;
    padding: 10px 18px;
    border-radius: 20px;
    cursor: pointer;
    transition: all 0.2s ease;
  }

  button:hover, select:hover {
    background: #555;
    transform: scale(1.05);
  }

  /* VIDEO BOX */
  .video-box {
    position: absolute;
    border-radius: 20px;
    overflow: hidden;
    cursor: grab;
    resize: both;
    min-width: 150px;
    min-height: 120px;
    box-shadow: 0 8px 20px rgba(0,0,0,0.6);
    transition: transform 0.3s, box-shadow 0.3s;
    border: 2px solid #333;
    animation: popin 0.5s ease;
    background: #000;
  }

  .video-box:hover {
    transform: scale(1.03);
    box-shadow: 0 12px 25px rgba(0,0,0,0.8);
  }

  video {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
    border-radius: 20px;
  }

  @keyframes popin {
    0% { transform: scale(0.5); opacity: 0; }
    100% { transform: scale(1); opacity: 1; }
  }
</style>
</head>
<body>

<div id="controls">
  <button id="muteBtn">Mute</button>
  <button id="camBtn">Camera Off</button>
  <select id="micSelect"></select>
  <select id="camSelect"></select>
</div>

<div id="videoContainer"></div>

<script>
  const videoContainer = document.getElementById('videoContainer');
  const muteBtn = document.getElementById('muteBtn');
  const camBtn = document.getElementById('camBtn');
  const micSelect = document.getElementById('micSelect');
  const camSelect = document.getElementById('camSelect');

  let localStream;
  let muted = false;
  let camOff = false;

  async function init() {
    const devices = await navigator.mediaDevices.enumerateDevices();

    devices.forEach(device => {
      if(device.kind === 'audioinput') {
        const option = document.createElement('option');
        option.value = device.deviceId;
        option.text = device.label || `Mic ${micSelect.length+1}`;
        micSelect.appendChild(option);
      }
      if(device.kind === 'videoinput') {
        const option = document.createElement('option');
        option.value = device.deviceId;
        option.text = device.label || `Camera ${camSelect.length+1}`;
        camSelect.appendChild(option);
      }
    });

    const stream = await navigator.mediaDevices.getUserMedia({ video: true, audio: true });
    localStream = stream;
    addVideoBox(stream, true);
  }

  function addVideoBox(stream, isLocal=false) {
    const box = document.createElement('div');
    box.className = 'video-box';
    box.style.top = `${50 + Math.random() * 200}px`;
    box.style.left = `${50 + Math.random() * 300}px`;

    const video = document.createElement('video');
    video.srcObject = stream;
    video.autoplay = true;
    video.muted = isLocal; 
    box.appendChild(video);
    videoContainer.appendChild(box);

    dragElement(box);
  }

  function dragElement(elmnt) {
    let pos1 = 0, pos2 = 0, pos3 = 0, pos4 = 0;
    elmnt.onmousedown = dragMouseDown;

    function dragMouseDown(e) {
      e.preventDefault();
      elmnt.style.cursor = "grabbing";
      pos3 = e.clientX;
      pos4 = e.clientY;
      document.onmouseup = closeDragElement;
      document.onmousemove = elementDrag;
    }

    function elementDrag(e) {
      e.preventDefault();
      pos1 = pos3 - e.clientX;
      pos2 = pos4 - e.clientY;
      pos3 = e.clientX;
      pos4 = e.clientY;
      const newTop = elmnt.offsetTop - pos2;
      const newLeft = elmnt.offsetLeft - pos1;

      // collision detection
      const boxes = document.querySelectorAll('.video-box');
      let colliding = false;
      boxes.forEach(b => {
        if(b !== elmnt) {
          const rect1 = {x:newLeft,y:newTop,w:elmnt.offsetWidth,h:elmnt.offsetHeight};
          const rect2 = {x:b.offsetLeft,y:b.offsetTop,w:b.offsetWidth,h:b.offsetHeight};
          if(rect1.x < rect2.x + rect2.w &&
             rect1.x + rect1.w > rect2.x &&
             rect1.y < rect2.y + rect2.h &&
             rect1.h + rect1.y > rect2.y) colliding = true;
        }
      });

      if(!colliding) {
        elmnt.style.top = newTop + "px";
        elmnt.style.left = newLeft + "px";
      }
    }

    function closeDragElement() {
      elmnt.style.cursor = "grab";
      document.onmouseup = null;
      document.onmousemove = null;
    }
  }

  muteBtn.onclick = () => {
    muted = !muted;
    localStream.getAudioTracks()[0].enabled = !muted;
    muteBtn.innerText = muted ? 'Unmute' : 'Mute';
  }

  camBtn.onclick = () => {
    camOff = !camOff;
    localStream.getVideoTracks()[0].enabled = !camOff;
    camBtn.innerText = camOff ? 'Camera On' : 'Camera Off';
  }

  micSelect.onchange = async () => {
    const newStream = await navigator.mediaDevices.getUserMedia({ audio: { deviceId: micSelect.value }, video: camOff ? false : true });
    localStream.removeTrack(localStream.getAudioTracks()[0]);
    localStream.addTrack(newStream.getAudioTracks()[0]);
  }

  camSelect.onchange = async () => {
    const newStream = await navigator.mediaDevices.getUserMedia({ video: { deviceId: camSelect.value }, audio: muted ? false : true });
    localStream.removeTrack(localStream.getVideoTracks()[0]);
    localStream.addTrack(newStream.getVideoTracks()[0]);
  }

  init();
</script>

</body>
</html>
