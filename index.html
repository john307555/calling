<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Advanced Meet UI</title>
<script src="https://unpkg.com/peerjs@1.5.4/dist/peerjs.min.js"></script>
<style>
:root {
  --bg: #0f1116;
  --dock-bg: rgba(26,31,38,.85);
  --accent-green: #1aa260;
  --accent-red: #e53935;
  --accent-blue: #1a73e8;
  --text: #e8eaed;
  --shadow: 0 20px 50px rgba(0,0,0,.55);
  --radius: 16px;
}

* { box-sizing: border-box; margin:0; padding:0; }
body { background: var(--bg); font-family: system-ui,sans-serif; color: var(--text); overflow:hidden; height:100vh; }

#stage { position:absolute; inset:0; display:flex; flex-wrap:wrap; gap:16px; justify-content:center; align-content:center; padding:16px; }

.video-box { position:relative; width:320px; height:180px; background:black; border-radius:16px; overflow:hidden; box-shadow:var(--shadow); border:2px solid transparent; transition:all .3s ease; }
.video-box.speaking { border-color: var(--accent-green); box-shadow:0 0 10px 3px rgba(26,162,96,.3); }
video { width:100%; height:100%; object-fit:cover; }

.name-tag { position:absolute; bottom:6px; left:8px; background: rgba(0,0,0,.55); padding:4px 8px; border-radius:8px; font-size:12px; }

#dock { position:fixed; top:50%; left:20px; transform:translateY(-50%); display:flex; flex-direction:column; gap:12px; background:var(--dock-bg); padding:12px; border-radius:20px; box-shadow:var(--shadow); }

.ctrl-btn { width:50px; height:50px; border-radius:50%; border:none; background:#2a3038; color:white; cursor:pointer; display:grid; place-items:center; font-size:20px; position:relative; transition:all .2s ease; }
.ctrl-btn:hover { transform:scale(1.1); background:#353c45; }
.ctrl-btn.off { background: var(--accent-red); }

.modal { position:fixed; inset:0; display:flex; align-items:center; justify-content:center; background:rgba(0,0,0,.5); z-index:100; visibility:hidden; opacity:0; transition:opacity .3s ease; }
.modal.show { visibility:visible; opacity:1; }
.modal-content { background:var(--dock-bg); padding:20px; border-radius:16px; min-width:240px; display:flex; flex-direction:column; gap:10px; position:relative; }
.modal-content button { padding:10px; border:none; border-radius:12px; background:#2a3038; color:white; cursor:pointer; transition:all .2s ease; }
.modal-content button:hover { background:#353c45; }
.modal-close { position:absolute; top:8px; right:8px; cursor:pointer; font-weight:bold; font-size:18px; }

</style>
</head>
<body>

<div id="stage"></div>

<!-- LEFT DOCK -->
<div id="dock">
  <button class="ctrl-btn" id="micBtn">ðŸŽ¤</button>
  <button class="ctrl-btn" id="camBtn">ðŸ“·</button>
  <button class="ctrl-btn" id="shareBtn">ðŸ–¥</button>
</div>

<!-- MODALS -->
<div class="modal" id="micModal">
  <div class="modal-content">
    <div class="modal-close" id="micClose">âœ–</div>
  </div>
</div>

<div class="modal" id="camModal">
  <div class="modal-content">
    <div class="modal-close" id="camClose">âœ–</div>
  </div>
</div>

<script>
const stage = document.getElementById("stage");
const micBtn = document.getElementById("micBtn");
const camBtn = document.getElementById("camBtn");
const shareBtn = document.getElementById("shareBtn");

const micModal = document.getElementById("micModal");
const camModal = document.getElementById("camModal");
const micClose = document.getElementById("micClose");
const camClose = document.getElementById("camClose");

let localStream;
let micOn = true;
let camOn = true;

/* ================= PEERJS ================= */
const peer = new Peer(undefined, { host:"peerjs.com", secure:true, port:443 });
const peers = {};

/* ================= INIT MEDIA ================= */
async function initMedia() {
  localStream = await navigator.mediaDevices.getUserMedia({ video:true, audio:true });
  addVideo("You", localStream, true);
}

/* ================= VIDEO UI ================= */
function addVideo(label, stream, muted=false) {
  const box = document.createElement("div");
  box.className = "video-box";
  const video = document.createElement("video");
  video.srcObject = stream;
  video.autoplay = true;
  video.muted = muted;

  const tag = document.createElement("div");
  tag.className = "name-tag";
  tag.textContent = label;

  box.append(video, tag);
  stage.appendChild(box);
}

/* ================= MIC / CAM ================= */
micBtn.onclick = () => {
  micOn = !micOn;
  localStream.getAudioTracks()[0].enabled = micOn;
  micBtn.classList.toggle("off", !micOn);
  showModal(micModal, "audioinput");
};

camBtn.onclick = () => {
  camOn = !camOn;
  localStream.getVideoTracks()[0].enabled = camOn;
  camBtn.classList.toggle("off", !camOn);
  showModal(camModal, "videoinput");
};

shareBtn.onclick = async () => {
  const s = await navigator.mediaDevices.getDisplayMedia({ video:true });
  addVideo("Screen", s);
};

/* ================= MODAL LOGIC ================= */
function showModal(modal, kind) {
  const content = modal.querySelector(".modal-content");
  content.querySelectorAll("button.device").forEach(b=>b.remove());
  navigator.mediaDevices.enumerateDevices().then(devices=>{
    devices.forEach(d=>{
      if(d.kind===kind){
        const btn = document.createElement("button");
        btn.className="device";
        btn.textContent=d.label||d.kind;
        btn.onclick=async()=>{
          if(kind==="audioinput"){
            const s = await navigator.mediaDevices.getUserMedia({ audio:{deviceId:d.deviceId} });
            localStream.getAudioTracks()[0].stop();
            localStream.removeTrack(localStream.getAudioTracks()[0]);
            localStream.addTrack(s.getAudioTracks()[0]);
          }else{
            const s = await navigator.mediaDevices.getUserMedia({ video:{deviceId:d.deviceId} });
            localStream.getVideoTracks()[0].stop();
            localStream.removeTrack(localStream.getVideoTracks()[0]);
            localStream.addTrack(s.getVideoTracks()[0]);
          }
          modal.classList.remove("show");
        };
        content.appendChild(btn);
      }
    });
  });
  modal.classList.add("show");
}

[micClose, camClose].forEach(c=>c.onclick=()=>c.parentElement.parentElement.classList.remove("show"));
[micModal, camModal].forEach(m=>m.addEventListener("click",e=>{if(e.target===m)m.classList.remove("show");}));

initMedia();
</script>
</body>
</html>
